# duckOSM Data Dictionary

This document describes the structure of the DuckDB database generated by duckOSM.

**Schemas:**
- `raw`: Original OSM data from PBF
- `<mode>`: Processed routing data (e.g., `driving`, `walking`, `cycling`)

---

## `<mode>` Schema

### Table: `nodes`

| Column | Type | Description |
|--------|------|-------------|
| `node_id` | BIGINT | Node ID. Positive = OSM ID, **Negative = virtual node** |
| `geom` | GEOMETRY | Point geometry |
| `h3_cell` | BIGINT | H3 spatial index (resolution 8 by default) |

#### Virtual Nodes
Self-loop edges (cul-de-sacs) are split at midpoint, creating virtual nodes:
- **ID Scheme**: `virtual_node_id = -(original_edge_id)`
- **Example**: Edge `456` loop → virtual node `-456`

---

### Table: `edges`

| Column | Type | Description |
|--------|------|-------------|
| `edge_id` | INTEGER | Unique edge identifier |
| `source` | BIGINT | Starting node ID |
| `target` | BIGINT | Ending node ID |
| `osm_id` | BIGINT | Original OSM way ID |
| `highway` | VARCHAR | Highway type |
| `name` | VARCHAR | Road name |
| `maxspeed` | VARCHAR | Raw OSM maxspeed string |
| `length_m` | FLOAT | Length in meters |
| `maxspeed_kmh` | FLOAT | Normalized speed (km/h) |
| `cost_s` | FLOAT | Travel time in seconds |
| `geometry` | GEOMETRY | LineString geometry |
| `is_reverse` | BOOLEAN | True if opposite direction |
| `refs` | BIGINT[] | Shape point node IDs |
| `from_cell` | BIGINT | H3 cell of source node |
| `to_cell` | BIGINT | H3 cell of target node |
| `lca_res` | TINYINT | Resolution of Lowest Common Ancestor between from/to cells |

---

### Table: `edge_graph`
Line graph for edge-based routing.

| Column | Type | Description |
|--------|------|-------------|
| `from_edge` | INTEGER | Incoming edge ID |
| `to_edge` | INTEGER | Outgoing edge ID |
| `via_edge` | INTEGER | Same as to_edge |
| `cost` | FLOAT | Travel cost of from_edge |

**Rule**: Edge A → Edge B exists if `target(A) == source(B)`

---

### Table: `turn_restrictions`

| Column | Type | Description |
|--------|------|-------------|
| `restriction_id` | BIGINT | OSM relation ID |
| `restriction_type` | VARCHAR | e.g., `no_left_turn` |
| `via_node` | BIGINT | Junction node ID |
| `from_edge_id` | INTEGER | Incoming edge |
| `to_edge_id` | INTEGER | Outgoing edge |

---

## `raw` Schema

| Table | Key Columns |
|-------|-------------|
| `raw.nodes` | `osm_id`, `lat`, `lon`, `tags` |
| `raw.ways` | `osm_id`, `tags`, `refs` |
| `raw.relations` | `osm_id`, `tags`, `refs`, `ref_roles`, `ref_types` |

---

## Global Schema (default)

### Table: `visualization_metadata`
Stores computed metadata for frontend visualization.

| Column | Type | Description |
|--------|------|-------------|
| `boundary_geojson` | VARCHAR | GeoJSON of calculation boundary (convex hull or bbox) |
| `center_lat` | DOUBLE | Latitude of map center |
| `center_lon` | DOUBLE | Longitude of map center |
| `initial_zoom` | INTEGER | Recommended initial zoom level (1-14) |
